---
output: html_document
editor_options: 
  chunk_output_type: console
format:
  html:
    html-table-processing: none
    toc-depth: 3
---

# Concordances {.unnumbered}

```{r packages and setup}
#| include: false
library(tidyverse)
library(stringi)
library(gt)
source("script/utils.R")
options(readr.show_col_types = FALSE)

print_concordance_catalogue <- function(catalogue) {
  notes <-
    read_csv("data/catalogue_notes.csv") %>% 
    filter(catalogue == {{catalogue}}) %>% 
    select(number, notes)
  
  read_rds("data_generated/works.rds") %>% 
    left_join(
      read_csv("data/catalogue_overview.csv") %>% distinct(group, file),
      by = "group"
    ) %>% 
    unite(group:number, col = "WerW", sep = ".", na.rm = TRUE) %>%
    mutate(
      number = .data[[catalogue]],
      WerW = str_glue("[{WerW}](/groups/{file}.html#work-{WerW})")
    ) %>%
    separate_longer_delim(number, delim = ", ") %>% 
    select(number, WerW) %>% 
    mutate(number = str_remove(number, " \\(\\?\\)$")) %>% 
    bind_rows(notes) %>% 
    filter(!is.na(number)) %>%
    summarise(
      .by = number,
      WerW = str_flatten_comma(WerW, na.rm = TRUE),
      notes = str_flatten_comma(notes, na.rm = TRUE)
    ) %>%
    mutate(WerW = if_else(WerW == "", "–", WerW)) %>% 
    arrange(
      stri_rank(number, opts_collator = stri_opts_collator(numeric = TRUE))
    ) %>% 
    gt() %>%
    cols_width(number ~ px(80), WerW ~ px(160)) %>%
    fmt_markdown(columns = WerW) %>% 
    sub_missing(columns = notes, missing_text = "") %>% 
    tab_options(
      column_labels.font.weight = "bold",
      table.align = "left",
      table_body.hlines.style = "none"
    )
}

print_concordance_ref <- function(ref, patterns) {
  patterns <- c(
    ".+\\[",
    patterns,
    "]"
  )

  read_rds("data_generated/works.rds") %>%
    left_join(
      read_csv("data/catalogue_overview.csv") %>% distinct(group, file),
      by = "group"
    ) %>%
    unite(group:number, col = "WerW", sep = ".", na.rm = TRUE) %>%
    mutate(WerW = str_glue("[{WerW}](/groups/{file}.html#work-{WerW})")) %>%
    separate_longer_delim(literature, ", @") %>%
    filter(str_detect(literature, ref)) %>%
    select(literature, WerW) %>%
    separate_wider_regex(
      literature,
      patterns = {{patterns}}
    ) %>%
    mutate(across(!WerW, parse_guess)) %>%
    arrange(pick(!WerW)) %>%
    gt() %>%
    fmt_markdown(columns = WerW) %>%
    tab_options(
      column_labels.font.weight = "bold",
      table.align = "left",
      table_body.hlines.style = "none"
    )
}
```


## Catalogues

### @Dopf1956 (Dopf)

```{r Dopf}
#| echo: false
#| output: asis
print_concordance_catalogue("Dopf")
```


### @Harich1932 (HarBu)

```{r HarBu}
#| echo: false
#| output: asis
print_concordance_catalogue("HarBu")
```


### @Harich1990 (HarCa)

Generally, Hárich included works from the 1737/38 inventory as separate works in his catalogue, even if the work title is so generic that it may correspond to an extant work.

```{r HarCa}
#| echo: false
#| output: asis
print_concordance_catalogue("HarCa")
```


### @Harich1975 (HarIn)

```{r HarIn}
#| echo: false
#| output: asis
print_concordance_catalogue("HarIn")
```


### @Petermayr2020 (PetSi)

```{r PetSi}
#| echo: false
#| output: asis
print_concordance_catalogue("PetSi")
```


### @Petermayr2015 (PetWe)

```{r PetWe}
#| echo: false
#| output: asis
print_concordance_catalogue("PetWe")
```


### @Reichert1935 (ReiMa)

```{r ReiMa}
#| echo: false
#| output: asis
print_concordance_catalogue("ReiMa")
```


### @WinklerKlement2020 (WinMa)

```{r WinMa}
#| echo: false
#| output: asis
print_concordance_catalogue("WinMa")
```



## Inventories (historic)

### @BrtniceInv

```{r Brtnice inventory}
#| echo: false
#| output: asis
print_concordance_ref(
  "BrtniceInv",
  patterns = c(
    "p. ",
    p. = "\\d+",
    ", no. ",
    no. = "\\d+"
  )
)
```


### @EsterhazyInv1805

```{r Esterhazy inventory 1805}
#| echo: false
#| output: asis
print_concordance_ref(
  "EsterhazyInv1805",
  patterns = c(
    "fol. ",
    fol. = ".+",
    ", no. ",
    no. = "\\d+"
  )
)
```


### @EsterhazyInv1812

```{r Esterhazy inventory 1812}
#| echo: false
#| output: asis
print_concordance_ref(
  "EsterhazyInv1812",
  patterns = c(
    genre = ".+",
    " no. ",
    no. = "\\d+"
  )
)
```


### @Sauer1809

```{r Sauer 1809}
#| echo: false
#| output: asis
print_concordance_ref(
  "Sauer1809",
  patterns = c(
    "fol. ",
    fol. = ".+",
    ", no. ",
    no. = ".+"
  )
)
```



## Inventories (modern)

### @Bardos1976

```{r Bardos 1976}
#| echo: false
#| output: asis
print_concordance_ref(
  "Bardos1976",
  patterns = c(
    "p. ",
    p. = ".+",
    ", no. ",
    no. = "\\d+"
  )
)
```


### @Bardos1980

```{r Bardos 1980}
#| echo: false
#| output: asis
print_concordance_ref(
  "Bardos1980",
  patterns = c(
    "p. ",
    p. = ".+",
    ", no. ",
    no. = ".+"
  )
)
```


### @Bardos1984

```{r Bardos 1984}
#| echo: false
#| output: asis
print_concordance_ref(
  "Bardos1984",
  patterns = c(
    "p. ",
    p. = ".+",
    ", no. ",
    no. = ".+"
  )
)
```


### @WinklerKlement2013

```{r Winkler-Klement 2013}
#| echo: false
#| output: asis
print_concordance_ref(
  "WinklerKlement2013",
  patterns = c(
    "pp?. ",
    p. = ".+"
  )
)
```


### @Rostetter2023

```{r Rostetter 2023}
#| echo: false
#| output: asis
print_concordance_ref(
  "Rostetter2023",
  patterns = c(
    "p. ",
    p. = ".+",
    ", no. ",
    no. = ".+"
  )
)
```
